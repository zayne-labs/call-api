---
title: React Query
description: Learn how to use CallApi with React Query
---

## Basic Usage

```ts title="todo.tsx"
import { callApi } from "@zayne-labs/callapi";
import { isHTTPErrorInstance } from "@zayne-labs/callapi";
import { useQuery } from "@tanstack/react-query";

type Todo = {
	id: number;
	title: string;
	completed: boolean;
};

const { data, isPending, isError, error } = useQuery({
	queryKey: ["todos"],
	queryFn: () => {
		return callApi<Todo[], unknown, "onlySuccessWithException">("https://my-api.com/api/v1/session", {
			throwOnError: true,
			resultMode: "onlySuccessWithException",
		});
	},
});
```

As seen above, we're using both `throwOnError` and `resultMode: "onlySuccessWithException"` ensure that only successful responses are returned and the error is thrown properly. This is necessary because React Query expects a promise in both `error` and `success` cases, but CallApi returns a discriminated union of data, error and the original response by default.

We also had to pass `onlySuccessWithException` as a generic argument to callApi due to an unfortunate [limitation of TypeScript](https://github.com/microsoft/TypeScript/issues/26242).

To avoid this, you can either:

1. Use validation libraries like zod to validate the response data so the type can be inferred automatically

```ts title="todo.tsx"
import { callApi } from "@zayne-labs/callapi";
import { z } from "zod";
import { useQuery } from "@tanstack/react-query";

const todosSchema = z.array(
	z.object({
		id: z.number(),
		title: z.string(),
		completed: z.boolean(),
	})
);

const { data, isPending, isError, error } = useQuery({
	queryKey: ["todos"],
	queryFn: () => {
		return callApi("https://my-api.com/api/v1/session", {
			responseValidator: todosSchema.parse,
			throwOnError: true,
			resultMode: "onlySuccessWithException",
		});
	},
});
```

2. Pass `false` to the errorData generic argument to signal that the error will be thrown

```ts title="todo.tsx"
import { callApi } from "@zayne-labs/callapi";
import { useQuery } from "@tanstack/react-query";

type Todo = {
	id: number;
	title: string;
	completed: boolean;
};

const { data, isPending, isError, error } = useQuery({
	queryKey: ["todos"],
	queryFn: () => {
		return callApi<Todo[], false>("https://my-api.com/api/v1/session", {
			throwOnError: true,
			resultMode: "onlySuccessWithException",
		});
	},
});
```
